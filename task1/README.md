# Задача "Понимание JVM"

## Код для исследования

```java
public class JvmComprehension {                                 // 1
    public static void main(String[] args) {                    // 2
        int i = 1;                                              // 3
        Object o = new Object();                                // 4
        Integer ii = 2;                                         // 5
        printAll(o, i, ii);                                     // 6
        System.out.println("finished");                         // 9
    }

    private static void printAll(Object o, int i, Integer ii) {
        Integer uselessVar = 700;                               // 7
        System.out.println(o.toString() + i + ii);              // 8
    }
}                                                               // 10
```

## Описание кода с точки зрения происходящего в JVM

__1. `public class JvmComprehension { `__

**ClassLoader** подгружает все необходимые системные классы в **Metaspace**
и загружает мета-данные класса **JvmComprehension**

__2. `public static void main(String[] args) {`__

В **Stack** создаётся фрейм для метода `main()`

__3. `int i = 1;`__

Локальная переменная со своим значением `i = 1` помещается в **Stack** во фрейм **main**

__4. `Object o = new Object();`__

В **Heap** выделяется память под объект класса **Object**,
а ссылка `o` на созданный объект в **Heap** помещается в **Stack** во фрейм **main**

__5. `Integer ii = 2;`__

В **Heap** выделяется память под объект класса **Integer** который
инициализируется значением **_2_**. Ссылка `ii` на созданный объект в **Heap**
помещается в **Stack** во фрейм **main**

__6. `printAll(o, i, ii);`__

В **Stack** создаётся новый фрейм для метода `printAll()`. В этот фрейм помещаются:

* ссылка `o` на ранее созданный **Object** в **Heap**,
* локальная переменная `i = 1`,
* ссылка `ii` на ранее созданный **Integer** в **Heap**

__7. `Integer uselessVar = 700;`__

В **Heap** выделяется память под объект класса **Integer** который инициализируется значением **_700_**.                                    
Ссылка **uselessVar** на созданный объект в **Heap** помещается в **Stack** во фрейм **printAll**

__8. `System.out.println(o.toString() + i + ii);`__

Для каждого из полей `o`, `i` и `ii` вызывается метод `toString()`. 
Для каждого такого вызова создается отдельный фрейм в **Stack**, который удаляется из **Stack** после выполнения этих методов.
В **Heap** выделяется память под новый объект класса **String** в который заносится результат конкатенации строк.
В **Stack** создаётся новый фрейм для метода `println()`. Ссылка на созданный объект помещается во фрейм **println**.
После выполнения метода `println()` фрейм **println** удаляется из **Stack**. Новый объект типа **String** может быть удалён из **Heap** при следующем
запуске **Garbage collector**, т.к. отсутствует ссылка на данный объект (_"мёртвый"_ объект).
После выполнение метода `printAll()` фрейм удаляется из **Stack**

__9. `System.out.println("finished");`__

В **Heap** выделяется память под новый объект класса **String**, который инициализируется значением `finished`.
В **Stack** создаётся новый фрейм для метода `println()`. Ссылка на созданный объект помещается во фрейм **println**.
После выполнения метода `println()` фрейм **println** удаляется из **Stack**. Фрейм **main** удаляется из **Stack**.